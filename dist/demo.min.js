(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=Quill;var n=e.n(t);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function l(e,t,n){return t=u(t),function(e,t){if(t&&("object"==r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,a()?Reflect.construct(t,n||[],u(e).constructor):t.apply(e,n))}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(a=function(){return!!e})()}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},s.apply(null,arguments)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,e),n=t,i=[{key:"create",value:function(e){var n,r,o,i,l,a=(n=t,r="create",o=this,l=s(u(1&(i=2)?n.prototype:n),r,o),2&i?function(e){return l.apply(o,e)}:l)([e]);if(!0===e)return a;var c=document.createElement("img");return c.setAttribute("src",e),a.appendChild(c),a}}],(r=null)&&o(n.prototype,r),i&&o(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,i}(n().import("blots/embed"));f.blotName="loading-image",f.className="image-uploading",f.tagName="span";const d=f;function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function g(e){var t=function(e,t){if("object"!=p(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==p(t)?t:t+""}var m=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.quill=t,this.options=n,this.range=null,this.placeholderDelta=null,this.placeholderIndex=null,"function"!=typeof this.options.upload&&console.warn("[Missing config] upload function that returns a promise is required");var r=this.quill.getModule("toolbar");r&&r.addHandler("image",this.selectLocalImage.bind(this)),this.handleDrop=this.handleDrop.bind(this),this.handlePaste=this.handlePaste.bind(this),this.quill.root.addEventListener("drop",this.handleDrop,!1),this.quill.root.addEventListener("paste",this.handlePaste,!1)},r=[{key:"register",value:function(){n().register({"formats/loading-image":d},!0)}}],(t=[{key:"selectLocalImage",value:function(){var e=this;this.quill.focus(),this.range=this.quill.getSelection(),this.fileHolder=document.createElement("input"),this.fileHolder.setAttribute("type","file"),this.fileHolder.setAttribute("accept","image/*"),this.fileHolder.setAttribute("style","visibility:hidden"),this.fileHolder.onchange=this.fileChanged.bind(this),document.body.appendChild(this.fileHolder),this.fileHolder.click(),window.requestAnimationFrame((function(){document.body.removeChild(e.fileHolder)}))}},{key:"handleDrop",value:function(e){var t=this;if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){if(e.stopPropagation(),e.preventDefault(),document.caretRangeFromPoint){var n=document.getSelection(),r=document.caretRangeFromPoint(e.clientX,e.clientY);n&&r&&n.setBaseAndExtent(r.startContainer,r.startOffset,r.startContainer,r.startOffset)}else{var o=document.getSelection(),i=document.caretPositionFromPoint(e.clientX,e.clientY);o&&i&&o.setBaseAndExtent(i.offsetNode,i.offset,i.offsetNode,i.offset)}this.quill.focus(),this.range=this.quill.getSelection();var l=e.dataTransfer.files[0];setTimeout((function(){t.quill.focus(),t.range=t.quill.getSelection(),t.readAndUploadFile(l)}),0)}}},{key:"handlePaste",value:function(e){var t=this,n=e.clipboardData||window.clipboardData;if(n&&(n.items||n.files))for(var r=n.items||n.files,o=/^image\/(jpe?g|gif|png|svg|webp)$/i,i=function(){if(o.test(r[l].type)){var n=r[l].getAsFile?r[l].getAsFile():r[l];n&&(t.quill.focus(),t.range=t.quill.getSelection(),e.preventDefault(),setTimeout((function(){t.quill.focus(),t.range=t.quill.getSelection(),t.readAndUploadFile(n)}),0))}},l=0;l<r.length;l++)i()}},{key:"readAndUploadFile",value:function(e){var t=this,n=new AbortController,r=new FileReader;r.addEventListener("load",(function(){r.result&&t.insertBase64Image(r.result)}),{signal:n.signal}),e&&r.readAsDataURL(e),this.options.upload(e).then((function(e){e&&t.insertToEditor(e)}),(function(e){n.abort(),t.removeBase64Image(),console.warn(e)}))}},{key:"fileChanged",value:function(){var e=this.fileHolder.files[0];this.readAndUploadFile(e)}},{key:"insertBase64Image",value:function(e){this.removeBase64Image();var t=this.range;t&&(this.placeholderIndex=t.index,this.placeholderDelta=this.quill.insertEmbed(t.index,d.blotName,"".concat(e),"user"))}},{key:"insertToEditor",value:function(e){this.removeBase64Image();var t=this.range;this.quill.insertEmbed(t.index,"image","".concat(e),"user"),t.index++,this.quill.setSelection(t,"user")}},{key:"removeBase64Image",value:function(){if(!this.placeholderDelta)return!1;var e=this.placeholderDelta.ops.reduce((function(e,t){return t.hasOwnProperty("insert")&&e++,e}),0);return this.quill.deleteText(this.placeholderIndex,e),this.placeholderDelta=null,this.placeholderIndex=null,!0}}])&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();const y=m;n().debug("warn"),n().register("modules/imageUploader",y);var b=new(n())("#editor",{theme:"snow",modules:{toolbar:{container:[[{header:[1,2,3,!1]}],["bold","italic"],["clean"],["image"]]},imageUploader:{upload:function(e){var t=new FileReader;return new Promise((function(n,r){t.addEventListener("load",(function(){var e=t.result;setTimeout((function(){n(e)}),1500)}),!1),e?t.readAsDataURL(e):r("No file selected")}))}}}});b.on("text-change",(function(e,t,n){"api"==n?console.log("An API call triggered this change."):"user"==n&&console.log("A user action triggered this change."),console.log(t,e)})),b.on("selection-change",(function(e,t,n){if(e)if(0==e.length)console.log("User cursor is on",e.index);else{var r=b.getText(e.index,e.length);console.log("User has highlighted",r)}else console.log("Cursor not in the editor")}))})();